<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PWA com Notifica√ß√µes Firebase</title>
<link rel="manifest" href="manifest.json">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; }
</style>
</head>
<body>
<h1>PWA Firebase Push Teste</h1>
<p id="status">Inicializando‚Ä¶</p>

<script src="firebase-config.js"></script>
<script>
const statusEl = document.getElementById('status');
const vapidKey = 'BK1Vsw-Pp7cMx2ejEA8iA5_g2JIVp157aiA60UNT7d40Zj9OgSBsNuEios8SwmKDpCR8GgmLjUBxAuF8brKZRWI'; // üî∑ Pegue no Firebase Console ‚Üí Cloud Messaging ‚Üí Chave p√∫blica para Web Push

async function init() {
  try {
    if (!('serviceWorker' in navigator)) {
      throw new Error('Service Worker n√£o suportado.');
    }

    const registration = await navigator.serviceWorker.register('service-worker.js');
    console.log('‚úÖ Service Worker registrado:', registration);

    const permission = await Notification.requestPermission();
    if (permission !== 'granted') {
      throw new Error('Permiss√£o para notifica√ß√µes n√£o concedida.');
    }

    const messaging = firebase.messaging();

    const token = await messaging.getToken({
      serviceWorkerRegistration: registration,
      vapidKey
    });

    console.log('‚úÖ Token FCM:', token);
    statusEl.textContent = 'Token FCM gerado: ' + token;

    // opcional: salvar no Firebase Realtime Database
    const dbRef = firebase.database().ref('tokens');
    dbRef.push(token);

    messaging.onMessage(payload => {
      console.log('üì® Mensagem recebida:', payload);
      alert(`Notifica√ß√£o recebida: ${payload.notification.title}`);
    });

  } catch (err) {
    console.error(err);
    statusEl.textContent = '‚ùå Erro: ' + err.message;
  }
}

init();
</script>
</body>
</html>
