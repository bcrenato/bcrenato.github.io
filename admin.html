<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
  <h2>Painel Admin</h2>

  <form id="formNotificacao" class="mb-3">
    <div class="row">
      <div class="col-md-4">
        <input type="text" name="titulo" class="form-control" placeholder="Título" required>
      </div>
      <div class="col-md-4">
        <input type="text" name="mensagem" class="form-control" placeholder="Mensagem" required>
      </div>
      <div class="col-md-4">
        <input type="url" name="url" class="form-control" placeholder="URL ao clicar" required>
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-2">Enviar Notificação</button>
  </form>

  <div id="status" class="alert d-none"></div>

  <h4>Tokens Registrados</h4>
  <ul id="listaTokens" class="list-group"></ul>
</div>

<script>
document.getElementById('formNotificacao').addEventListener('submit', e => {
  e.preventDefault();

  const form = e.target;
  const data = {
    titulo: form.titulo.value,
    mensagem: form.mensagem.value,
    url: form.url.value
  };

  fetch('enviar.php', {
    method: 'POST',
    body: JSON.stringify(data)
  }).then(res => res.json()).then(json => {
    const s = document.getElementById('status');
    s.textContent = json.message;
    s.className = 'alert alert-success';
    s.classList.remove('d-none');
  }).catch(err => {
    const s = document.getElementById('status');
    s.textContent = 'Erro ao enviar.';
    s.className = 'alert alert-danger';
    s.classList.remove('d-none');
  });
});

// opcional — listar tokens
fetch('listar_tokens.php')
.then(r => r.json())
.then(tokens => {
  const ul = document.getElementById('listaTokens');
  tokens.forEach(t => {
    const li = document.createElement('li');
    li.className = 'list-group-item small';
    li.textContent = t;
    ul.appendChild(li);
  });
});
</script>

</body>
</html>
